FROM ubuntu:latest

MAINTAINER Exadra37

RUN apt-get update && apt-get -y upgrade

# Install Required Dependencies
RUN apt-get -y install \
    ca-certificates \
    curl \
    git \
    python \
    sudo \
    libcanberra-gtk-module \
    libgtk2.0-0 \
    --no-install-recommends

# Force Install of missing dependencies
RUN apt-get -y -f install

# Cleanup
RUN rm -rf /var/lib/apt/lists/*

RUN locale-gen en_GB.UTF-8
ENV LANG en_GB.UTF-8
ENV LANGUAGE en_GB:en
ENV LC_ALL en_GB.UTF-8

ARG HOST_USER="${HOST_USER:-dockerize-sublime}"
ARG HOST_UID="${HOST_UID:-2000}"
ARG HOST_GID="${HOST_GID:-2000}"
ARG SUBLIME_BUILD="${SUBLIME_BUILD:-3126}"

#Add new sudo user
RUN useradd -m "${HOST_USER}" && \
    echo "${HOST_USER}:${HOST_USER}" | chpasswd && \
    usermod --shell /bin/bash "${HOST_USER}" && \
    usermod -aG sudo "${HOST_USER}" && \
    echo "${HOST_USER} ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers.d/"${HOST_USER}" && \
    chmod 0440 /etc/sudoers.d/"${HOST_USER}" && \
    usermod  --uid "${HOST_UID}" "${HOST_USER}" && \
    groupmod --gid "${HOST_GID}" "${HOST_USER}"

# Install Sublime
RUN curl -O https://download.sublimetext.com/sublime-text_build-"${SUBLIME_BUILD}"_amd64.deb
RUN dpkg -i -R sublime-text_build-"${SUBLIME_BUILD}"_amd64.deb
RUN rm -rvf sublime-text_build-"${SUBLIME_BUILD}"_amd64.deb

# Run Sublime
CMD ["/opt/sublime_text/sublime_text", "-w"]
